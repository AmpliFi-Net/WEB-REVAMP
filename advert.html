<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Advert (AmpliFi)</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    body { margin:0; padding:0; background:transparent; }
    .fade-card { animation: fadeCard .5s ease-out both; }
    @keyframes fadeCard { from { opacity:0; transform: translateY(6px); } to { opacity:1; transform: translateY(0); } }
    .gradient-animated {
      background: linear-gradient(90deg,#06b6d4,#34d399,#60a5fa);
      -webkit-background-clip: text;
      background-clip: text;
      color: transparent;
      animation: shimmer 3s linear infinite;
      background-size: 200% auto;
    }
    @keyframes shimmer {
      0%{background-position:0% 50%}
      50%{background-position:100% 50%}
      100%{background-position:0% 50%}
    }
    .pill { display:inline-block; padding:4px 10px; border-radius:999px; font-size:12px; font-weight:600; }
  </style>
</head>
<body>
  <div id="advert-content" class="max-w-5xl mx-auto p-4"></div>

  <script>
  (function() {
    const SCOREBAT_API = 'https://www.scorebat.com/video-api/v3/feed/?token=MTExNjNfMTcwNzQwMTg0Nl85MzhiYjRlMGI3MjVkZWEzMTU2ZTlmNGZmYmUyYjM1YjI1OTFkYzFh';
    const MAX_MATCHES = 6;

    const PRIORITY_LEAGUES = [
      'Premier League', 'EPL',
      'UEFA Champions League', 'Europa League', 'Conference League',
      'LaLiga', 'Serie A', 'Bundesliga', 'Ligue 1',
      'Kenya Premier League', 'Kenyan',
      'CAF Champions League', 'CAF Confederation Cup',
      'FIFA World Cup Qualifying', 'World Cup', 'International', 'Friendly', 'UEFA Euro Qualifiers', 'AFCON Qualifiers'
    ];

    const HOLIDAYS = {
      "01-01": { title: "ðŸŽ† Happy New Year!", message: "Start your year connected with AmpliFi WiFi!" },
      "06-01": { title: "ðŸ‘¨â€ðŸ‘©â€ðŸ‘§â€ðŸ‘¦ Madaraka Day", message: "Celebrate Kenyaâ€™s self-rule â€” stay connected with AmpliFi!" },
      "10-09": { title: "ðŸŒ¿ Mazingira Day", message: "Tomorrow is Mazingira Day â€” go green and stay connected!" },
      "10-20": { title: "ðŸ‡°ðŸ‡ª Mashujaa Day", message: "Tomorrow is Mashujaa Day â€” celebrate Kenyaâ€™s heroes with AmpliFi!" },
      "12-12": { title: "ðŸŽ‰ Jamhuri Day", message: "Tomorrow is Jamhuri Day â€” celebrate independence online with AmpliFi!" },
      "12-25": { title: "ðŸŽ„ Merry Christmas!", message: "Spread holiday joy with fast, reliable AmpliFi WiFi!" },
      "12-31": { title: "ðŸŽŠ New Yearâ€™s Eve", message: "Ring in the new year online with AmpliFi!" }
    };

    function getNairobiMMDD(offsetDays=0) {
      const now = new Date();
      const parts = new Intl.DateTimeFormat('en-GB', { timeZone:'Africa/Nairobi', year:'numeric', month:'2-digit', day:'2-digit' })
        .formatToParts(now)
        .reduce((a,p)=> (a[p.type]=p.value,a), {});
      const yyyy = Number(parts.year), mm = Number(parts.month), dd = Number(parts.day);
      const date = new Date(Date.UTC(yyyy, mm-1, dd));
      date.setUTCDate(date.getUTCDate()+offsetDays);
      const mmS = String(date.getUTCMonth()+1).padStart(2,'0');
      const ddS = String(date.getUTCDate()).padStart(2,'0');
      return `${mmS}-${ddS}`;
    }

    function toNairobiTime(iso) {
      const d = new Date(iso);
      const fmt = new Intl.DateTimeFormat('en-GB', {
        timeZone:'Africa/Nairobi',
        hour:'2-digit', minute:'2-digit', hour12:false
      });
      return fmt.format(d);
    }

    function isPriority(comp) {
      if (!comp) return false;
      return PRIORITY_LEAGUES.some(x => comp.toLowerCase().includes(x.toLowerCase()));
    }

    function holidayCard(h) {
      return `
        <div class="bg-white rounded-2xl shadow-xl p-6 mb-6 fade-card">
          <h3 class="text-2xl font-bold gradient-animated mb-2">${h.title}</h3>
          <p class="text-gray-700 text-lg">${h.message}</p>
        </div>`;
    }

    function matchCard(m) {
      const comp = (m.competition && (m.competition.name||m.competition)) || 'Match';
      const kickoff = toNairobiTime(m.date);
      const title = m.title || `${m.side1?.name || ''} vs ${m.side2?.name || ''}`;
      return `
        <div class="bg-white rounded-2xl shadow-md p-4 mb-3 fade-card hover:shadow-lg transition">
          <div class="flex justify-between items-start">
            <div>
              <div class="text-gray-500 text-sm mb-1">${comp}</div>
              <div class="font-semibold text-gray-800">${title}</div>
              <div class="text-sm text-gray-600 mt-1">Kickoff: ${kickoff}</div>
            </div>
            <a href="${m.matchviewUrl||m.url}" target="_blank" rel="noopener" class="pill bg-gray-100 text-blue-700 hover:bg-blue-100">View</a>
          </div>
        </div>`;
    }

    async function loadAdvert() {
      const container = document.getElementById('advert-content');
      container.innerHTML = '';
      const tomorrowMMDD = getNairobiMMDD(1);
      const todayMMDD = getNairobiMMDD(0);
      const holidayTomorrow = HOLIDAYS[tomorrowMMDD];
      const blocks = [];

      // Add holiday advert on top
      if (holidayTomorrow) blocks.push(holidayCard(holidayTomorrow));

      // Load football matches
      try {
        const res = await fetch(SCOREBAT_API, { cache:'no-store' });
        if (!res.ok) throw new Error('API Error');
        const json = await res.json();
        const items = json.response || [];
        const todayMatches = items.filter(m => {
          if (!m.date) return false;
          const d = new Date(m.date);
          const mmdd = new Intl.DateTimeFormat('en-GB', { timeZone:'Africa/Nairobi', month:'2-digit', day:'2-digit' })
            .formatToParts(d).reduce((a,p)=> (a[p.type]=p.value,a), {});
          const key = `${mmdd.month}-${mmdd.day}`;
          return key === todayMMDD;
        });
        const selected = todayMatches.filter(m => isPriority((m.competition && (m.competition.name||'')) || m.title))
                                     .slice(0, MAX_MATCHES);
        if (selected.length) {
          blocks.push(`<div class="bg-white/80 rounded-2xl shadow-inner p-4 fade-card">
            <h2 class="text-xl font-bold gradient-animated mb-3">âš½ Top Matches Today</h2>
            ${selected.map(matchCard).join('')}
          </div>`);
        }
      } catch(err) {
        console.warn('ScoreBat load failed', err);
      }

      if (blocks.length) {
        container.innerHTML = `
          <div class="bg-gradient-to-r from-white/70 to-white/50 backdrop-blur-md border border-gray-200 rounded-3xl p-6 shadow-lg">
            ${blocks.join('')}
          </div>`;
      } else {
        container.remove();
      }
    }

    loadAdvert();
    setInterval(loadAdvert, 3 * 60 * 60 * 1000);
  })();
  </script>
</body>
</html>
