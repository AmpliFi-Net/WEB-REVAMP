<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Advert (AmpliFi)</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    body { margin:0; padding:0; background:transparent; font-family: 'Inter', sans-serif; }
    .fade-card { animation: fadeCard .5s ease-out both; }
    @keyframes fadeCard { from { opacity:0; transform: translateY(8px); } to { opacity:1; transform: translateY(0); } }

    .gradient-animated {
      background: linear-gradient(90deg,#06b6d4,#34d399,#60a5fa);
      -webkit-background-clip: text;
      background-clip: text;
      color: transparent;
      animation: shimmer 3s linear infinite;
      background-size: 200% auto;
    }

    @keyframes shimmer {
      0%{background-position:0% 50%}
      50%{background-position:100% 50%}
      100%{background-position:0% 50%}
    }

    /* rotation animation for promos */
    .fade-in { opacity:0; animation: fadeIn 1s forwards; }
    @keyframes fadeIn {
      from { opacity:0; transform: translateY(10px); }
      to { opacity:1; transform: translateY(0); }
    }
  </style>
</head>
<body>
  <div id="advert-content" class="max-w-5xl mx-auto p-4"></div>

  <script>
  (function() {
    const SCOREBAT_API = 'https://www.scorebat.com/video-api/v3/feed/?token=MTExNjNfMTcwNzQwMTg0Nl85MzhiYjRlMGI3MjVkZWEzMTU2ZTlmNGZmYmUyYjM1YjI1OTFkYzFh';
    const MAX_MATCHES = 10;

    const PRIORITY_LEAGUES = [
      'Premier League','EPL','UEFA Champions League','Europa League',
      'Conference League','LaLiga','Serie A','Bundesliga','Ligue 1',
      'Kenya Premier League','Kenyan','CAF Champions League','World Cup','Qualifiers'
    ];

    const HOLIDAYS = {
      "01-01": { title: "üéÜ Happy New Year!", message: "Start your year connected with AmpliFi WiFi!" },
      "06-01": { title: "üë®‚Äçüë©‚Äçüëß‚Äçüë¶ Madaraka Day", message: "Celebrate Kenya‚Äôs self-rule ‚Äî stay connected with AmpliFi!" },
      "10-09": { title: "üåø Mazingira Day", message: "Tomorrow is Mazingira Day ‚Äî go green and stay connected!" },
      "10-20": { title: "üá∞üá™ Mashujaa Day", message: "Tomorrow is Mashujaa Day ‚Äî celebrate Kenya‚Äôs heroes with AmpliFi!" },
      "12-12": { title: "üéâ Jamhuri Day", message: "Tomorrow is Jamhuri Day ‚Äî celebrate independence online with AmpliFi!" },
      "12-25": { title: "üéÑ Merry Christmas!", message: "Spread holiday joy with fast, reliable AmpliFi WiFi!" },
      "12-31": { title: "üéä New Year‚Äôs Eve", message: "Ring in the new year online with AmpliFi!" }
    };

    const PROMOS = [
      { title: "‚ö° Fast. Reliable. Unlimited.", text: "Experience blazing speeds with AmpliFi WiFi." },
      { title: "üåç Connect Freely", text: "Stay online anywhere, anytime ‚Äî powered by AmpliFi." },
      { title: "üí° Smart Internet, Smarter Living", text: "Enjoy seamless browsing, streaming, and gaming." }
    ];

    function getNairobiMMDD(offsetDays=0) {
      const now = new Date();
      const parts = new Intl.DateTimeFormat('en-GB', { timeZone:'Africa/Nairobi', year:'numeric', month:'2-digit', day:'2-digit' })
        .formatToParts(now)
        .reduce((a,p)=> (a[p.type]=p.value,a), {});
      const yyyy = Number(parts.year), mm = Number(parts.month), dd = Number(parts.day);
      const date = new Date(Date.UTC(yyyy, mm-1, dd));
      date.setUTCDate(date.getUTCDate()+offsetDays);
      const mmS = String(date.getUTCMonth()+1).padStart(2,'0');
      const ddS = String(date.getUTCDate()).padStart(2,'0');
      return `${mmS}-${ddS}`;
    }

    function toNairobiTime(iso) {
      const d = new Date(iso);
      const fmt = new Intl.DateTimeFormat('en-GB', {
        timeZone:'Africa/Nairobi',
        hour:'2-digit', minute:'2-digit', hour12:false
      });
      return fmt.format(d);
    }

    function isPriority(comp) {
      if (!comp) return false;
      return PRIORITY_LEAGUES.some(x => comp.toLowerCase().includes(x.toLowerCase()));
    }

    function holidayCard(h) {
      return `
        <div class="bg-white rounded-2xl shadow-xl p-6 mb-6 fade-card">
          <h3 class="text-2xl font-bold gradient-animated mb-2">${h.title}</h3>
          <p class="text-gray-700 text-lg">${h.message}</p>
        </div>`;
    }

    function matchesListCard(matches) {
      return `
        <div class="bg-white/90 rounded-2xl shadow-md p-5 fade-card">
          <h2 class="text-xl font-bold gradient-animated mb-3">‚öΩ Top Matches Today</h2>
          <ul class="divide-y divide-gray-200 text-gray-800 text-sm">
            ${matches.map(m => {
              const comp = (m.competition && (m.competition.name||m.competition)) || '';
              const title = m.title || `${m.side1?.name || ''} vs ${m.side2?.name || ''}`;
              const kickoff = toNairobiTime(m.date);
              return `
                <li class="py-2 flex justify-between items-center">
                  <span class="truncate">
                    <strong>${title}</strong> <span class="text-gray-500">(${comp})</span>
                  </span>
                  <span class="text-blue-600 font-medium">${kickoff}</span>
                </li>`;
            }).join('')}
          </ul>
        </div>`;
    }

    function promoMessageRotator(container) {
      let i = 0;
      function rotate() {
        const p = PROMOS[i % PROMOS.length];
        container.innerHTML = `
          <div class="bg-white rounded-2xl shadow-md p-6 fade-in text-center">
            <h3 class="text-xl font-bold gradient-animated mb-2">${p.title}</h3>
            <p class="text-gray-700">${p.text}</p>
          </div>`;
        i++;
      }
      rotate();
      setInterval(rotate, 5000); // change every 5s
    }

    async function loadAdvert() {
      const container = document.getElementById('advert-content');
      container.innerHTML = '';
      const tomorrowMMDD = getNairobiMMDD(1);
      const todayMMDD = getNairobiMMDD(0);
      const holidayTomorrow = HOLIDAYS[tomorrowMMDD];
      const blocks = [];

      if (holidayTomorrow) blocks.push(holidayCard(holidayTomorrow));

      try {
        const res = await fetch(SCOREBAT_API, { cache:'no-store' });
        if (!res.ok) throw new Error('API error');
        const json = await res.json();
        const items = json.response || [];
        const todayMatches = items.filter(m => {
          if (!m.date) return false;
          const d = new Date(m.date);
          const mmdd = new Intl.DateTimeFormat('en-GB', { timeZone:'Africa/Nairobi', month:'2-digit', day:'2-digit' })
            .formatToParts(d).reduce((a,p)=> (a[p.type]=p.value,a), {});
          const key = `${mmdd.month}-${mmdd.day}`;
          return key === todayMMDD;
        });

        const matches = todayMatches.filter(m => isPriority((m.competition && (m.competition.name||'')) || m.title))
                                    .slice(0, MAX_MATCHES);
        if (matches.length) blocks.push(matchesListCard(matches));
      } catch (err) {
        console.warn('‚ö†Ô∏è Could not load matches:', err);
      }

      if (blocks.length) {
        container.innerHTML = `
          <div class="bg-gradient-to-r from-white/70 to-white/50 backdrop-blur-md border border-gray-200 rounded-3xl p-6 shadow-lg">
            ${blocks.join('')}
          </div>`;
      } else {
        // If no holiday or match, show rotating promo
        const promoBox = document.createElement('div');
        promoMessageRotator(promoBox);
        container.appendChild(promoBox);
      }
    }

    loadAdvert();
    setInterval(loadAdvert, 3 * 60 * 60 * 1000);
  })();
  </script>
</body>
</html>
